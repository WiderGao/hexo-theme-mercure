<%_  let flatNavMenu = (menu, depth = 0) => { %>
<app-list dense>
<%_ menu.forEach((item) => { _%>
    <%_ if(item === 'divider') { _%> 
    <!-- <li class="menu-divider"></li> -->
    <%_ } else { _%>
        <%_ let cascade = item.submenu&&item.submenu.length>0 _%> 
        <%_ if(cascade) { _%> 
            <app-popover sub-menu trigger="click" width="140px">
                <app-list-item dense slot="toggle" href="<%= item.url %>">
                    <!-- <div slot="prefix">prefix</div> -->
                    <div slot="title"><%- item.name %></div>
                    <div slot="suffix"><i class="ri-arrow-drop-right-fill"></i></div>
                </app-list-item>
                <%_ flatNavMenu(item.submenu, depth + 1) _%>
            </app-popover>
        <%_ } else { _%>
            <app-list-item dense href="<%= item.url %>">
                <!-- <div slot="prefix">prefix</div> -->
                <div slot="title"><%- item.name %></div>
            </app-list-item>
        <%_ } _%>
    <%_ } _%>
<%_ }) _%>
</app-list>
<%_ } _%>

<%_  let flatNavCollapse = (menu, depth = 0) => { %>
    <%_ menu.forEach((item) => { _%>
        <%_ if(item === 'divider') { _%> 
        <%_ } else { _%>
            <%_ let cascade = item.submenu&&item.submenu.length>0 _%> 
            <%_ if(cascade) { _%>
            <app-list-group>
                <app-list-item slot="toggle">
                    <div slot="prefix">
                        <% for(let i=0; i<depth; i++) { %><span class="blank px-2"></span><% } %> 
                        <i class="iconfont icon-arrow-down inline-block w-4"></i>
                    </div>
                    <div slot="title">
                        <a class="link" href="<%= item.url %>"><%- item.name %></a>
                    </div>
                </app-list-item>
                <%# 递归展开子菜单 _%>
                <%_ if(cascade) { _%>
                <%_ flatNavCollapse(item.submenu, depth + 1) _%>
                <%_ } _%> 
            </app-list-group>
            <%_ } else { _%> 
            <app-list-item>
                <div slot="prefix">
                    <% for(let i=0; i<depth; i++) { %><span class="blank px-2"></span><% } %>
                    <span class="px-2"></span>
                </div>
                <div slot="title">
                    <a class="link" href="<%= item.url %>"><%- item.name %></a>
                </div>
            </app-list-item>
            <%_ } _%>
        <%_ } _%>
    <%_ }) _%>
<%_ } _%>
<div class="navigator nav-hide">
    <div class="content">
        <div class="nav-left-drawer">
            <button class="drawer-toggle" onclick="document.querySelector('#drawer-left').open=true"><i class="ri-menu-line"></i></button>
        </div>
        <div class="nav-logo">
            <a href="/"><%- theme.navigator.logo %></a>
        </div>
        <div class="nav-menu">
            <ul class="nav-menu-list">
            <%_ theme.navigator.menu.forEach((item) => { _%>
                <%_ let cascade = item.submenu&&item.submenu.length>0 _%> 
                <li class="nav-menu-item">
                    <%_ if(cascade) { _%> 
                    <app-popover trigger="click" width="140px">
                        <div slot="toggle">
                            <%_ if(item.url) { _%> 
                            <a href="<%= item.url %>"><%- item.name %></a>
                            <%_ } else { _%>
                            <span><%- item.name %></span>
                            <%_ } _%>
                            <i class="ri-arrow-drop-down-fill"></i>
                        </div>
                        <%_ if(cascade) flatNavMenu(item.submenu) _%>
                    </app-popover>
                    <%_ } else { _%>
                        <a class="link" href="<%= item.url %>"><%- item.name %></a>
                    <%_ } _%>
                </li>
            <%_ }) _%> 
            </ul>
        </div>
        <div class="nav-toolkit">
            <!-- <button class="music-player-toggle"><i class="ri-music-2-fill"></i></button> -->
            <%#- partial('../_widget/music_player') %>
        <%_ if(theme.navigator.darkmode) { _%>
            <button class="dark-theme-toggle" data-tippy-content="深色模式"><i class="ri-contrast-2-line"></i></button>
        <%_ } _%>
        <%_ if(theme.navigator.search) { _%>
            <button slot="toggle" class="search-toggle" 
                data-tippy-content="搜索"
                onclick="document.querySelector('#search-modal').open=true"
            ><i class="ri-search-line"></i></button>
        <%_ } _%>
        </div>
        <div class="nav-right-drawer">
            <button class="drawer-toggle" onclick="document.querySelector('#drawer-right').open=true"><i class="ri-layout-right-line"></i></button>
        </div>
    </div>
</div>
<!-- <div class="nav-menu-drawer drawer drawer-closed">
    <#%- partial('../_widget/profile') %>
    <#%_ flatNavCollapse(theme.navigator.menu) _%>
</div> -->
<!-- <div class="nav-sidebar-drawer drawer drawer-closed">
    <div id="sidebar-drawer"><#%- partial('./sidebar') %></div>
</div> -->
<app-drawer id="drawer-left" placement="left" position="fixed">
    <%- partial('../_widget/profile') %>
    <%_ flatNavCollapse(theme.navigator.menu) _%>
</app-drawer>
<app-drawer id="drawer-right" placement="right" position="fixed" width="272px">
    <div id="sidebar-drawer"><%- partial('./sidebar', {show_profile: false}) %></div>
</app-drawer>

<%_ if(theme.navigator.search) { _%>
<app-modal id="search-modal">
    <%- partial('../_widget/search') %>
</app-modal>
<%_ } _%>
